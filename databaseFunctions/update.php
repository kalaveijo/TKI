<?php

include_once("../phpClasses/Log.php");
include_once("../common/dbConnect.php");
include_once("../common/functions.php");
include_once("../common/dbFunctions.php");

$log = new Log();

 //'{"project":[{"id":"5","identifier":"hoqummetoeywfj","diary_number":"bjafevnxnsex","projectcode":"sdgsdgkzzhcqcdvjr","project_name":"flwksxjl","acronym":"ccraskoidlsvdbuf","focuse_areas":"jxyltmefgikd","metropolia_coordinator":"rttgc","degree_program_related":"vnzhonmxg","start_day":null,"end_day":null,"inspector":null,"inspected_day":null,"funding_application":null,"funding_application_signed_day":null,"deniend_application":null,"targeted_budget":null,"offer":null,"invitation_to_tender":null,"invention_announcement":null,"ethical_estimates_on":null,"general_project_information":null,"valid_starttime":"2012-11-19 16:22:25","valid_endtime":null,"user_id":null}],"projectpartner":[{"id":"17","cluster_unit":null,"degree_program":"xfyiylhpvlwagzkjbuq","responsible_person_lname":null,"responsible_person_fname":null,"responsible_person_role":null,"valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"user_id":null},{"id":"18","cluster_unit":null,"degree_program":"ypisqfgfyicqosrshdt","responsible_person_lname":null,"responsible_person_fname":null,"responsible_person_role":null,"valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"user_id":null}],"contract":[{"id":"8","contract_type":null,"lname":"vnrtuzpncztsoiyb","fname":"zvxyqrgxhyystmvcsyovycz","role":null,"sign_day":"6071-12-07","valid_starttime":"2012-11-19 16:22:25","valid_endtime":null,"user_id":null}],"funder":[{"id":"7","valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"funder_name":"nrepmel","user_id":null},{"id":"8","valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"funder_name":"mwox","user_id":null}],"researchpermit":[{"id":"7","research_name":"rmocsirjj","research_permit_type":"dlabnzlwdskerht","organisation":"orxdmzmgri","first_name":"fqnsjv","last_name":"yjt","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"user_id":null},{"id":"8","research_name":"sevpnetpacikbsg","research_permit_type":"dtlqttysiqucq","organisation":"ypsuepcnpmnzzztyavn","first_name":"vzajzehrbswquilcxuu","last_name":"aosxljepivyvmtwipvqymw","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-11-19 16:22:26","valid_endtime":null,"user_id":null}],"microtime":0.010429859161377}';
$_POST['data'] = '{"project":[{"id":"8","identifier":"tmazzfnwfexueaxnq","diary_number":"yglobng","projectcode":"rcb","project_name":"varjoneekeri","acronym":"dfpkbjajjcq","focuse_areas":"ckjzmjvsfqad","metropolia_coordinator":"goqsqisnwcohtsxr","degree_program_related":"evequa","start_day":null,"end_day":null,"inspector":null,"inspected_day":null,"funding_application":null,"funding_application_signed_day":null,"deniend_application":null,"targeted_budget":null,"offer":null,"invitation_to_tender":null,"invention_announcement":null,"ethical_estimates_on":null,"general_project_information":null,"valid_starttime":"2012-12-03 16:27:08","valid_endtime":null,"user_id":"1", "user_vst":"2012-01-01 00:00:00"}],"projectpartner":[{"id":"1","cluster_unit":null,"degree_program":"vdpyvtnh","responsible_person_lname":null,"responsible_person_fname":null,"responsible_person_role":null,"valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"user_id":"1", "user_vst":"2012-01-01 00:00:00"}],"externalstakeholder":[{"id":"1","contactperson_firstname":"uzjpwsuqigz","contactperson_lastname":"idavlkqm","contactperson_role":null,"address":null,"zip":null,"state":null,"phone_number":null,"email_address":null,"country":"vbv","network":null,"valid_starttime":"2012-12-03 16:27:08","valid_endtime":null,"user_id":null}],"contract":[{"id":"1","contract_type":null,"lname":"syeedkatqv","fname":"ffxhgmcnaqxohmceuujb","role":null,"sign_day":"3433-12-07","valid_starttime":"2012-12-03 16:27:08","valid_endtime":null,"user_id":null},{"id":"2","contract_type":null,"lname":"bzcornwthnbtstjjqypiwv","fname":"vsyqnyhblarggtxyuvqws","role":null,"sign_day":"1083-11-20","valid_starttime":"2012-12-03 16:27:08","valid_endtime":null,"user_id":null}],"funder":[{"id":"1","valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"funder_name":"lsldvnawvvpmdk","user_id":null},{"id":"2","valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"funder_name":"soa","user_id":null},{"id":"3","valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"funder_name":"jukneqhlw","user_id":null},{"id":"4","valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"funder_name":"mbfa","user_id":null},{"id":"5","valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"funder_name":"dydqkwu","user_id":null}],"researchpermit":[{"id":"1","research_name":"vhrxjjguftoiddigxhhihz","research_permit_type":"uaghsbdbyncedeyhbt","organisation":"noy","first_name":"gt","last_name":"bflrig","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"user_id":null},{"id":"2","research_name":"hmqmqicqknkpkxhbjdnubbv","research_permit_type":"ugszbvatjegclaevdcnsc","organisation":"dnqsolobrlnxehg","first_name":"iyztqqh","last_name":"qohoudzwewgsnnwvounzcm","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-12-03 16:27:09","valid_endtime":null,"user_id":"1", "user_vst":"2012-01-01 00:00:00"}],"microtime":0.010931968688965}';
//$_POST['data'] = '{"project":[{"id":"10","identifier":"qotgz","diary_number":"pfpckhjwikpabhbhkr","projectcode":"wvaqxsm","project_name":"MOAR","acronym":"bbzwupnao","focuse_areas":"ctglmqb","metropolia_coordinator":"hivhbwrnz","degree_program_related":"jgygvjcnizpq","start_day":null,"end_day":null,"inspector":null,"inspected_day":null,"funding_application":null,"funding_application_signed_day":null,"deniend_application":null,"targeted_budget":null,"offer":null,"invitation_to_tender":null,"invention_announcement":null,"ethical_estimates_on":null,"general_project_information":null,"valid_starttime":"2012-11-19 16:22:30","valid_endtime":null,"user_id":null}],"projectpartner":[{"id":"27","cluster_unit":null,"degree_program":"voomnnkdkignftylrodopmrsrg","responsible_person_lname":null,"responsible_person_fname":null,"responsible_person_role":null,"valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"user_id":null},{"id":"28","cluster_unit":null,"degree_program":"osqrykkponhw","responsible_person_lname":null,"responsible_person_fname":null,"responsible_person_role":null,"valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"user_id":null}],"contract":[{"id":"19","contract_type":null,"lname":"uhijpwjkbcnmasm","fname":"rax","role":null,"sign_day":"4659-09-01","valid_starttime":"2012-11-19 16:22:30","valid_endtime":null,"user_id":null},{"id":"20","contract_type":null,"lname":"dxjdlwalermyabl","fname":"zshyvxojy","role":null,"sign_day":"5288-04-26","valid_starttime":"2012-11-19 16:22:30","valid_endtime":null,"user_id":null},{"id":"21","contract_type":null,"lname":"bymowvb","fname":"nfnhsujqejjw","role":null,"sign_day":"6520-09-18","valid_starttime":"2012-11-19 16:22:30","valid_endtime":null,"user_id":null}],"funder":[{"id":"15","valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"funder_name":"sfwi","user_id":null},{"id":"16","valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"funder_name":"jwkvbujna","user_id":null},{"id":"17","valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"funder_name":"aiznaytwfdadhrp","user_id":null}],"researchpermit":[{"id":"23","research_name":"hfkgjolgnxxqn","research_permit_type":"xmwsyhibtoluddapvrthoyl","organisation":"bfpwpjfo","first_name":"qsoscmlzisa","last_name":"aqn","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"user_id":null},{"id":"24","research_name":"yjjt","research_permit_type":"mxiglpcwzoi","organisation":"ijeajkz","first_name":"kljbzsunrgedgw","last_name":"hvpfvbntudfnxtlfxty","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"user_id":null},{"id":"25","research_name":"pulnqstqveorya","research_permit_type":"qwfpbsietnpr","organisation":"njqsqfkkfl","first_name":"ur","last_name":"vewtdrefb","address":null,"zip":null,"state_address":null,"phone_number":null,"email_address":null,"tki_state":null,"ethical_review":null,"person_register":null,"permit_day":null,"denied":null,"valid_starttime":"2012-11-19 16:22:31","valid_endtime":null,"user_id":null}],"microtime":0.013447046279907}';
$_POST['table'] = '{"0":"project"}';

$data = json_decode($_POST['data'], true);
$table = json_decode($_POST['table'], true);

//$log->debug(do_dump($data));
//$log->debug(do_dump($table));

$parsedData = parseUpdateData($data, $table);

/*
$multiarray = array(
array("identifier", "degree_program_related", "inspector", "metropolia_coordinator"),
array("jeesuskristus", "rrr", "Matti", "afrikkalainen neekeri"),
array("varchar", "varchar", "varchar", "varchar")
);*/

echo(updateEntry($DBH, $innoDBH, $table[0], $parsedData['project'][0]['id'], prepareDataForDatabase($parsedData, $table[0])));

?>